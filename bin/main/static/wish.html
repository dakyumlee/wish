<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ§ ì†Œì›ë°˜ë‚©ì†Œ - í˜„ì‹¤ìê°íƒ€ì„â„¢</title>
  <style>
    @font-face {
      font-family: 'GangwonEdu_OTFBoldA';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2201-2@1.0/GangwonEdu_OTFBoldA.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    * {
      box-sizing: border-box;
    }

    :root {
      --primary-color: #ff6b95;
      --secondary-color: #ffa726;
      --accent-color: #e91e63;
      --text-color: #2d3436;
      --bg-color: #fffdf7;
      --card-bg: rgba(255, 255, 255, 0.95);
    }

    [data-theme="dark"] {
      --primary-color: #2d1b69;
      --secondary-color: #8e44ad;
      --accent-color: #e74c3c;
      --text-color: #ecf0f1;
      --bg-color: #0c0c0c;
      --card-bg: rgba(52, 73, 94, 0.95);
    }

    body {
      font-family: 'GangwonEdu_OTFBoldA', sans-serif;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      min-height: 100vh;
      margin: 0;
      padding: 1rem;
      position: relative;
      overflow-x: hidden;
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .raindrop {
      position: absolute;
      width: 2px;
      height: 20px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.6), transparent);
      animation: fall linear infinite;
    }

    @keyframes fall {
      0% { transform: translateY(-100vh) rotate(10deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(10deg); opacity: 0; }
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 2rem;
      position: relative;
      z-index: 2;
    }

    .header h1 {
      font-size: 2.5rem;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: glow 2s ease-in-out infinite alternate;
      cursor: pointer;
    }

    .header h1:hover {
      transform: scale(1.05);
      transition: transform 0.3s ease;
    }

    .header p {
      font-size: 1.2rem;
      margin: 0.5rem 0;
      opacity: 0.9;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .control-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .control-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }

    @keyframes glow {
      from { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(255,255,255,0.3); }
      to { text-shadow: 2px 2px 4px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.6); }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 2rem;
    }

    .chat-section {
      display: flex;
      flex-direction: column;
    }

    .chat-box {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      min-height: 400px;
      max-height: 600px;
      overflow-y: auto;
      margin-bottom: 2rem;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .chat {
      display: flex;
      margin-bottom: 1.5rem;
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat.user {
      justify-content: flex-end;
    }

    .chat.bot {
      justify-content: flex-start;
    }

    .bubble {
      max-width: 80%;
      padding: 1rem 1.5rem;
      border-radius: 20px;
      font-size: 1.1rem;
      line-height: 1.6;
      position: relative;
      word-wrap: break-word;
      transition: all 0.3s ease;
    }

    .bubble:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .user .bubble {
      background: linear-gradient(135deg, var(--accent-color), #ff8a80);
      color: white;
      border-bottom-right-radius: 5px;
      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
    }

    .bot .bubble {
      background: var(--card-bg);
      color: var(--text-color);
      border-bottom-left-radius: 5px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-left: 4px solid var(--accent-color);
      position: relative;
    }

    .bot .bubble .share-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: none;
      border: none;
      font-size: 0.8rem;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .bot .bubble:hover .share-btn {
      opacity: 1;
    }

    .typing-cursor {
      display: inline-block;
      width: 2px;
      height: 1em;
      background: var(--accent-color);
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .input-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .input-box {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    #wishInput {
      flex: 1;
      padding: 1rem 1.5rem;
      font-size: 1.1rem;
      border: 2px solid transparent;
      border-radius: 25px;
      outline: none;
      transition: all 0.3s ease;
      background: var(--bg-color);
      color: var(--text-color);
      font-family: inherit;
    }

    #wishInput:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
      transform: translateY(-2px);
    }

    .submit-btn {
      padding: 1rem 2rem;
      font-size: 1.1rem;
      background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
      position: relative;
      overflow: hidden;
    }

    .submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(233, 30, 99, 0.4);
    }

    .submit-btn:active {
      transform: translateY(-1px);
    }

    .submit-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transition: all 0.5s ease;
      transform: translate(-50%, -50%);
    }

    .submit-btn:active::before {
      width: 300px;
      height: 300px;
    }

    .quick-wishes {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .quick-wish {
      background: rgba(233, 30, 99, 0.1);
      border: 1px solid var(--accent-color);
      border-radius: 15px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text-color);
    }

    .quick-wish:hover {
      background: var(--accent-color);
      color: white;
      transform: translateY(-2px);
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .sidebar-section {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar-section h3 {
      margin: 0 0 1rem 0;
      color: var(--accent-color);
      font-size: 1.2rem;
    }

    .user-sidebar {
      display: block;
    }

    .admin-sidebar {
      display: none;
    }

    .admin-active .user-sidebar {
      display: none;
    }

    .admin-active .admin-sidebar {
      display: block;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .stat-item {
      text-align: center;
      padding: 1rem;
      background: rgba(233, 30, 99, 0.1);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      transform: translateY(-2px);
      background: rgba(233, 30, 99, 0.2);
    }

    .stat-number {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-color);
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.7;
    }

    .emotion-chart {
      margin-top: 1rem;
    }

    .emotion-bar {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .emotion-label {
      width: 60px;
      font-size: 0.9rem;
    }

    .emotion-progress {
      flex: 1;
      height: 8px;
      background: rgba(233, 30, 99, 0.1);
      border-radius: 4px;
      margin: 0 0.5rem;
      overflow: hidden;
    }

    .emotion-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .emotion-count {
      font-size: 0.8rem;
      opacity: 0.7;
      width: 20px;
    }

    .history-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .history-item {
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      background: rgba(233, 30, 99, 0.05);
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .history-item:hover {
      background: rgba(233, 30, 99, 0.1);
      border-left-color: var(--accent-color);
      transform: translateX(5px);
    }

    .history-time {
      font-size: 0.7rem;
      opacity: 0.5;
    }

    .admin-login {
      text-align: center;
      padding: 2rem;
    }

    .admin-input {
      padding: 0.8rem;
      margin: 0.5rem;
      border: 2px solid var(--accent-color);
      border-radius: 10px;
      background: var(--bg-color);
      color: var(--text-color);
      font-family: inherit;
    }

    .admin-btn {
      padding: 0.8rem 1.5rem;
      background: var(--accent-color);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-family: inherit;
      margin: 0.5rem;
    }

    .admin-conversations {
      max-height: 400px;
      overflow-y: auto;
    }

    .conversation-item {
      padding: 1rem;
      margin-bottom: 0.5rem;
      background: rgba(233, 30, 99, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .conversation-item:hover {
      background: rgba(233, 30, 99, 0.1);
      transform: translateY(-2px);
    }

    .conversation-preview {
      font-size: 0.9rem;
      opacity: 0.8;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: var(--card-bg);
      margin: 5% auto;
      padding: 2rem;
      border-radius: 20px;
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      right: 20px;
      top: 15px;
    }

    .close:hover {
      color: var(--accent-color);
    }

    .loading {
      display: none;
      text-align: center;
      padding: 1rem;
    }

    .loading-genie {
      font-size: 2rem;
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    .loading-text {
      margin-top: 0.5rem;
      opacity: 0.7;
    }

    .loading-dots::after {
      content: '';
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0% { content: ''; }
      33% { content: '.'; }
      66% { content: '..'; }
      100% { content: '...'; }
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent-color);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(0);
    }

    .chat-box::-webkit-scrollbar,
    .history-list::-webkit-scrollbar,
    .admin-conversations::-webkit-scrollbar {
      width: 6px;
    }

    .chat-box::-webkit-scrollbar-track,
    .history-list::-webkit-scrollbar-track,
    .admin-conversations::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.1);
      border-radius: 3px;
    }

    .chat-box::-webkit-scrollbar-thumb,
    .history-list::-webkit-scrollbar-thumb,
    .admin-conversations::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 3px;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .sidebar {
        order: -1;
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .input-box {
        flex-direction: column;
      }
      
      #wishInput, .submit-btn {
        width: 100%;
      }

      .quick-wishes {
        justify-content: center;
      }
      
      .modal-content {
        width: 95%;
        margin: 10% auto;
      }
    }

    .theme-toggle {
      position: relative;
      width: 50px;
      height: 25px;
      background: rgba(255,255,255,0.2);
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle::before {
      content: 'ğŸŒ™';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 21px;
      height: 21px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }

    [data-theme="dark"] .theme-toggle::before {
      content: 'â˜€ï¸';
      transform: translateX(25px);
    }
  </style>
</head>
<body>
  <div class="rain" id="rain"></div>
  
  <div class="header">
    <h1 onclick="playSound('genie')">ğŸ§ ì†Œì›ë°˜ë‚©ì†Œ</h1>
    <p>"ì†Œì›ì„ ë¹Œì—ˆì§€ë§Œ, ëŒì•„ì˜¨ ê±´ í˜„ì‹¤ ìê° íƒ€ì„ì´ì—ˆë‹¤"</p>
    <div class="controls">
      <div class="theme-toggle" onclick="toggleTheme()"></div>
      <button class="control-btn" onclick="toggleSound()">ğŸ”Š ì‚¬ìš´ë“œ</button>
      <button class="control-btn" onclick="clearHistory()">ğŸ—‘ï¸ ê¸°ë¡ì‚­ì œ</button>
      <button class="control-btn" onclick="getRandomWish()">ğŸ² ëœë¤ì†Œì›</button>
      <button class="control-btn" onclick="toggleAdmin()">ğŸ‘¤ Admin</button>
    </div>
  </div>

  <div class="container">
    <div class="chat-section">
      <div class="chat-box" id="chatBox">
        <div class="chat bot">
          <div class="bubble">ğŸ§ ì†Œì›ì„ ë§í•´ë³´ì„¸ìš”. í•˜ì§€ë§Œ ê²½ê³ í•˜ê±´ëŒ€, ì—¬ê¸°ì„œëŠ” ë‹¬ì½¤í•œ ìœ„ë¡œ ëŒ€ì‹  ì“°ë””ì“´ í˜„ì‹¤ì„ ëŒë ¤ë°›ê²Œ ë  ê²ë‹ˆë‹¤. ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? í”¼ì´~</div>
        </div>
      </div>

      <div class="input-container">
        <div class="input-box">
          <input type="text" id="wishInput" placeholder="ì†Œì›ì„ ì…ë ¥í•˜ì„¸ìš”... (ì˜ˆ: ë‚˜ ì‚¬ë‘ë°›ê³  ì‹¶ì–´)" onkeypress="handleEnter(event)" />
          <button class="submit-btn" onclick="submitWish()">ë°˜ë‚©í•˜ê¸°</button>
        </div>
        
        <div class="quick-wishes">
          <span class="quick-wish" onclick="setQuickWish('ë‚˜ ì‚¬ë‘ë°›ê³  ì‹¶ì–´')">ğŸ’• ì‚¬ë‘ë°›ê³  ì‹¶ì–´</span>
          <span class="quick-wish" onclick="setQuickWish('ë¶€ì ë˜ê³  ì‹¶ì–´')">ğŸ’° ë¶€ì ë˜ê³  ì‹¶ì–´</span>
          <span class="quick-wish" onclick="setQuickWish('ì˜¤ëŠ˜ ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ì–´')">ğŸ˜´ í•˜ê¸° ì‹«ì–´</span>
          <span class="quick-wish" onclick="setQuickWish('ì˜ˆë»ì§€ê³  ì‹¶ì–´')">âœ¨ ì˜ˆë»ì§€ê³  ì‹¶ì–´</span>
          <span class="quick-wish" onclick="setQuickWish('ë˜‘ë˜‘í•´ì§€ê³  ì‹¶ì–´')">ğŸ§  ë˜‘ë˜‘í•´ì§€ê³  ì‹¶ì–´</span>
          <span class="quick-wish" onclick="setQuickWish('í–‰ë³µí•˜ê³  ì‹¶ì–´')">ğŸ˜Š í–‰ë³µí•˜ê³  ì‹¶ì–´</span>
        </div>
        
        <div class="loading" id="loading">
          <div class="loading-genie">ğŸ§</div>
          <div class="loading-text">í˜„ì‹¤ìê° ì¤€ë¹„ì¤‘<span class="loading-dots"></span></div>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <div class="sidebar-section user-sidebar">
        <h3>ğŸ“œ ì†Œì› ê¸°ë¡</h3>
        <div class="history-list" id="historyList">
          <div style="text-align: center; opacity: 0.5; padding: 2rem;">
            ì•„ì§ ì†Œì›ì´ ì—†ì–´ìš”<br>ì²« ì†Œì›ì„ ë¹Œì–´ë³´ì„¸ìš”! ğŸ§
          </div>
        </div>
      </div>

      <div class="sidebar-section admin-sidebar">
        <div class="admin-login" id="adminLogin">
          <h3>ğŸ” Admin Login</h3>
          <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" class="admin-input" onkeypress="handleAdminEnter(event)">
          <br>
          <button class="admin-btn" onclick="adminLogin()">ë¡œê·¸ì¸</button>
        </div>

        <div id="adminPanel" style="display: none;">
          <h3>ğŸ“Š ì „ì²´ í†µê³„</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-number" id="totalWishes">0</div>
              <div class="stat-label">ì´ ì†Œì›</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="todayWishes">0</div>
              <div class="stat-label">ì˜¤ëŠ˜</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="totalUsers">0</div>
              <div class="stat-label">ì‚¬ìš©ì</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="topEmotion">-</div>
              <div class="stat-label">ì£¼ìš”ê°ì •</div>
            </div>
          </div>
          
          <div class="emotion-chart">
            <div class="emotion-bar">
              <span class="emotion-label">ì™¸ë¡œì›€</span>
              <div class="emotion-progress"><div class="emotion-fill" data-emotion="ì™¸ë¡œì›€"></div></div>
              <span class="emotion-count">0</span>
            </div>
            <div class="emotion-bar">
              <span class="emotion-label">ìš•ë§</span>
              <div class="emotion-progress"><div class="emotion-fill" data-emotion="ìš•ë§"></div></div>
              <span class="emotion-count">0</span>
            </div>
            <div class="emotion-bar">
              <span class="emotion-label">íšŒí”¼</span>
              <div class="emotion-progress"><div class="emotion-fill" data-emotion="íšŒí”¼"></div></div>
              <span class="emotion-count">0</span>
            </div>
            <div class="emotion-bar">
              <span class="emotion-label">ìŠ¬í””</span>
              <div class="emotion-progress"><div class="emotion-fill" data-emotion="ìŠ¬í””"></div></div>
              <span class="emotion-count">0</span>
            </div>
            <div class="emotion-bar">
              <span class="emotion-label">ì™¸ëª¨</span>
              <div class="emotion-progress"><div class="emotion-fill" data-emotion="ì™¸ëª¨"></div></div>
              <span class="emotion-count">0</span>
            </div>
            <div class="emotion-bar">
              <span class="emotion-label">ëŠ¥ë ¥</span>
              <div class="emotion-progress"><div class="emotion-fill" data-emotion="ëŠ¥ë ¥"></div></div>
              <span class="emotion-count">0</span>
            </div>
          </div>

          <h3>ğŸ’¬ ëŒ€í™” ë‚´ìš©</h3>
          <div class="admin-conversations" id="adminConversations">
            <div style="text-align: center; opacity: 0.5; padding: 2rem;">
              ëŒ€í™” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="conversationModal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>ğŸ’¬ ëŒ€í™” ìƒì„¸</h2>
      <div id="modalContent"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    let soundEnabled = true;
    let wishHistory = JSON.parse(localStorage.getItem('wishHistory') || '[]');
    let emotionStats = JSON.parse(localStorage.getItem('emotionStats') || '{}');
    let userStats = JSON.parse(localStorage.getItem('userStats') || '{ "total": 0, "today": 0, "streak": 0, "lastDate": null }');
    let isAdmin = false;

    document.addEventListener('DOMContentLoaded', function() {
      createRain();
      loadHistory();
      updateStats();
      updateEmotionChart();
      checkDailyStreak();
      document.getElementById('wishInput').focus();
    });

    function createRain() {
      const rain = document.getElementById('rain');
      for (let i = 0; i < 50; i++) {
        const drop = document.createElement('div');
        drop.className = 'raindrop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDuration = (Math.random() * 3 + 2) + 's';
        drop.style.animationDelay = Math.random() * 2 + 's';
        rain.appendChild(drop);
      }
    }

    function playSound(type) {
      if (!soundEnabled) return;
      const sounds = {
        click: 'ğŸ”Š',
        genie: 'âœ¨',
        success: 'ğŸ‰',
        error: 'âŒ'
      };
      console.log(`Playing sound: ${sounds[type]} ${type}`);
    }

    function toggleTheme() {
      const body = document.body;
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      playSound('click');
      showToast(`${newTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸'} ${newTheme === 'dark' ? 'ë‹¤í¬' : 'ë¼ì´íŠ¸'} ëª¨ë“œë¡œ ë³€ê²½ë¨`);
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      const btn = event.target;
      btn.textContent = soundEnabled ? 'ğŸ”Š ì‚¬ìš´ë“œ' : 'ğŸ”‡ ìŒì†Œê±°';
      showToast(soundEnabled ? 'ğŸ”Š ì‚¬ìš´ë“œ ì¼œì§' : 'ğŸ”‡ ì‚¬ìš´ë“œ êº¼ì§');
    }

    function toggleAdmin() {
      const body = document.body;
      if (isAdmin) {
        isAdmin = false;
        body.classList.remove('admin-active');
        showToast('ğŸ‘¤ ì¼ë°˜ ëª¨ë“œë¡œ ì „í™˜');
      } else {
        body.classList.add('admin-active');
        document.getElementById('adminPassword').focus();
      }
    }

    function handleAdminEnter(event) {
      if (event.key === 'Enter') {
        adminLogin();
      }
    }

    function adminLogin() {
      const password = document.getElementById('adminPassword').value;
      if (password === '980511') {
        isAdmin = true;
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        updateAdminStats();
        loadAdminConversations();
        showToast('ğŸ”“ Admin ë¡œê·¸ì¸ ì„±ê³µ!');
        playSound('success');
      } else {
        showToast('âŒ ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤');
        playSound('error');
        document.getElementById('adminPassword').value = '';
      }
    }

    function handleEnter(event) {
      if (event.key === 'Enter') {
        submitWish();
      }
    }

    function setQuickWish(wish) {
      document.getElementById('wishInput').value = wish;
      playSound('click');
    }

    function getRandomWish() {
      const randomWishes = [
        'ë‚´ì¼ì€ ë” ë‚˜ì€ í•˜ë£¨ê°€ ë˜ë©´ ì¢‹ê² ì–´',
        'ìŠ¤íŠ¸ë ˆìŠ¤ ì—†ì´ ì‚´ê³  ì‹¶ì–´',
        'ì§„ì§œ ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ì–´',
        'ë‚´ ê¿ˆì„ ì´ë£¨ê³  ì‹¶ì–´',
        'ê±´ê°•í•˜ê²Œ ì‚´ê³  ì‹¶ì–´',
        'ì—¬í–‰ ë§ì´ ë‹¤ë‹ˆê³  ì‹¶ì–´',
        'ìì‹ ê° ìˆê²Œ ì‚´ê³  ì‹¶ì–´',
        'í›„íšŒ ì—†ëŠ” ì„ íƒì„ í•˜ê³  ì‹¶ì–´',
        'í‰í™”ë¡œìš´ ë§ˆìŒì„ ê°–ê³  ì‹¶ì–´',
        'ì§„ì •í•œ ë‚˜ë¥¼ ì°¾ê³  ì‹¶ì–´'
      ];
      
      const randomWish = randomWishes[Math.floor(Math.random() * randomWishes.length)];
      document.getElementById('wishInput').value = randomWish;
      playSound('click');
      showToast('ğŸ² ëœë¤ ì†Œì›ì´ ìƒì„±ëì–´ìš”!');
    }

    async function submitWish() {
      const wishInput = document.getElementById("wishInput");
      const wish = wishInput.value.trim();
      
      if (!wish) {
        showToast("âŒ ì†Œì›ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      const chatBox = document.getElementById("chatBox");
      const loading = document.getElementById("loading");

      addMessage('user', wish);
      playSound('click');

      wishInput.value = "";
      loading.style.display = "block";
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const response = await fetch("/api/wish", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ wish })
        });

        if (!response.ok) {
          throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
        }

        const data = await response.json();

        loading.style.display = "none";

        await addTypingMessage('bot', data.response);
        playSound('success');

        saveWishToHistory(wish, data.response);
        updateWishStats(wish);

        if (isAdmin) {
          loadAdminConversations();
          updateAdminStats();
        }

      } catch (error) {
        loading.style.display = "none";
        
        const errorResponses = [
          "ğŸ§ ì„œë²„ê°€ í˜„ì‹¤ì„ ë°›ì•„ë“¤ì´ì§€ ëª»í•˜ê³  ìˆë„¤ìš”. ë‹¹ì‹ ë§Œí¼ì´ë‚˜ ë„ë§ì¹˜ê³  ì‹¶ë‚˜ ë´…ë‹ˆë‹¤. í”¼ì´~",
          "ğŸ§ ê¸°ìˆ ì  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì¸ìƒì˜ ì˜¤ë¥˜ëŠ” ê³ ì¹  ìˆ˜ ì—†ì£ . í‰¤ì—£~",
          "ğŸ§ ì—°ê²°ì— ì‹¤íŒ¨í–ˆë„¤ìš”. ì‚¬ëŒê³¼ì˜ ì—°ê²°ë„ ì´ë ‡ê²Œ ì‹¤íŒ¨í•˜ê³  ìˆëŠ” ê±´ ì•„ë‹Œê°€ìš”? í”¼ê³¤í•´ìš”."
        ];
        
        const randomResponse = errorResponses[Math.floor(Math.random() * errorResponses.length)];
        await addTypingMessage('bot', randomResponse);
        playSound('error');
      }

      chatBox.scrollTop = chatBox.scrollHeight;
      wishInput.focus();
    }

    function addMessage(type, content) {
      const chatBox = document.getElementById("chatBox");
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat ${type}`;
      
      const bubbleDiv = document.createElement('div');
      bubbleDiv.className = 'bubble';
      bubbleDiv.innerHTML = content;
      
      if (type === 'bot') {
        const shareBtn = document.createElement('button');
        shareBtn.className = 'share-btn';
        shareBtn.innerHTML = 'ğŸ“‹';
        shareBtn.onclick = () => copyToClipboard(content);
        bubbleDiv.appendChild(shareBtn);
      }
      
      messageDiv.appendChild(bubbleDiv);
      chatBox.appendChild(messageDiv);
    }

    async function addTypingMessage(type, content) {
      const chatBox = document.getElementById("chatBox");
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat ${type}`;
      
      const bubbleDiv = document.createElement('div');
      bubbleDiv.className = 'bubble';
      
      if (type === 'bot') {
        const shareBtn = document.createElement('button');
        shareBtn.className = 'share-btn';
        shareBtn.innerHTML = 'ğŸ“‹';
        shareBtn.onclick = () => copyToClipboard(content);
        bubbleDiv.appendChild(shareBtn);
      }
      
      messageDiv.appendChild(bubbleDiv);
      chatBox.appendChild(messageDiv);
      
      let i = 0;
      const cursor = document.createElement('span');
      cursor.className = 'typing-cursor';
      bubbleDiv.appendChild(cursor);
      
      const typeInterval = setInterval(() => {
        if (i < content.length) {
          const char = content.charAt(i);
          const textNode = document.createTextNode(char);
          bubbleDiv.insertBefore(textNode, cursor);
          i++;
          chatBox.scrollTop = chatBox.scrollHeight;
        } else {
          bubbleDiv.removeChild(cursor);
          clearInterval(typeInterval);
        }
      }, 30);
      
      return new Promise(resolve => {
        const checkComplete = setInterval(() => {
          if (i >= content.length) {
            clearInterval(checkComplete);
            resolve();
          }
        }, 100);
      });
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨!');
        playSound('success');
      }).catch(() => {
        showToast('âŒ ë³µì‚¬ ì‹¤íŒ¨');
      });
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function saveWishToHistory(wish, response) {
      const historyItem = {
        id: Date.now(),
        wish: wish,
        response: response,
        timestamp: new Date().toISOString(),
        emotion: detectEmotionClient(wish),
        userAgent: navigator.userAgent,
        ip: 'hidden'
      };
      
      wishHistory.unshift(historyItem);
      
      if (wishHistory.length > 100) {
        wishHistory = wishHistory.slice(0, 100);
      }
      
      localStorage.setItem('wishHistory', JSON.stringify(wishHistory));
      loadHistory();
    }

    function detectEmotionClient(wish) {
      wish = wish.toLowerCase();
      
      if (containsAny(wish, 'ì‚¬ë‘', 'ì¢‹ì•„', 'ì¸ê¸°', 'ì¹œêµ¬', 'ì—°ì¸', 'ë‚¨ì¹œ', 'ì—¬ì¹œ', 'ì™¸ë¡œ', 'í˜¼ì')) {
        return 'ì™¸ë¡œì›€';
      }
      if (containsAny(wish, 'ëˆ', 'ë¶€ì', 'ì„±ê³µ', 'ìœ ëª…', 'ì¸í”Œë£¨ì–¸ì„œ', 'ì›”ê¸‰', 'ì—°ë´‰', 'ìŠ¹ì§„', 'ì·¨ì—…')) {
        return 'ìš•ë§';
      }
      if (containsAny(wish, 'í•˜ê¸°ì‹«', 'ê·€ì°®', 'í”¼ê³¤', 'ì‰¬ê³ ', 'ì ', 'ë†€ê³ ', 'ì•ˆí•˜ê³ ', 'ë„ë§', 'ì—†ì–´ì ¸')) {
        return 'íšŒí”¼';
      }
      if (containsAny(wish, 'ìŠ¬í”„', 'ìš°ìš¸', 'ì£½ê³ ', 'ì‚¬ë¼ì§€ê³ ', 'í˜ë“¤', 'ì•„í”„', 'ê´´ë¡­', 'ëˆˆë¬¼', 'ìš¸ê³ ')) {
        return 'ìŠ¬í””';
      }
      if (containsAny(wish, 'ì˜ˆì˜', 'ì˜ìƒ', 'í‚¤', 'ëª¸ë§¤', 'ì‚´', 'ë‹¤ì´ì–´íŠ¸', 'ìš´ë™', 'ì–¼êµ´', 'ì„±í˜•')) {
        return 'ì™¸ëª¨';
      }
      if (containsAny(wish, 'ê³µë¶€', 'ì‹œí—˜', 'ì„±ì ', 'ëŒ€í•™', 'ì‹¤ë ¥', 'ë˜‘ë˜‘', 'ì²œì¬', 'ëŠ¥ë ¥')) {
        return 'ëŠ¥ë ¥';
      }
      
      return 'ê¸°íƒ€';
    }

    function containsAny(text, ...keywords) {
      return keywords.some(keyword => text.includes(keyword));
    }

    function loadHistory() {
      const historyList = document.getElementById('historyList');
      
      if (wishHistory.length === 0) {
        historyList.innerHTML = `
          <div style="text-align: center; opacity: 0.5; padding: 2rem;">
            ì•„ì§ ì†Œì›ì´ ì—†ì–´ìš”<br>ì²« ì†Œì›ì„ ë¹Œì–´ë³´ì„¸ìš”! ğŸ§
          </div>
        `;
        return;
      }
      
      const userHistory = wishHistory.slice(0, 10);
      
      historyList.innerHTML = userHistory.map(item => {
        const date = new Date(item.timestamp);
        const timeStr = date.toLocaleString('ko-KR', {
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        return `
          <div class="history-item" onclick="replayWish('${item.wish.replace(/'/g, "\\'")}')">
            <div>${item.wish}</div>
            <div class="history-time">${timeStr} Â· ${item.emotion}</div>
          </div>
        `;
      }).join('');
    }

    function replayWish(wish) {
      document.getElementById('wishInput').value = wish;
      showToast('ğŸ’« ì†Œì›ì´ ë‹¤ì‹œ ì„¤ì •ëì–´ìš”!');
      playSound('click');
    }

    function updateWishStats(wish) {
      const emotion = detectEmotionClient(wish);
      const today = new Date().toDateString();
      
      userStats.total++;
      
      if (userStats.lastDate !== today) {
        userStats.today = 1;
        userStats.lastDate = today;
        
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        if (userStats.lastDate === yesterday.toDateString()) {
          userStats.streak++;
        } else {
          userStats.streak = 1;
        }
      } else {
        userStats.today++;
      }
      
      emotionStats[emotion] = (emotionStats[emotion] || 0) + 1;
      
      localStorage.setItem('userStats', JSON.stringify(userStats));
      localStorage.setItem('emotionStats', JSON.stringify(emotionStats));
      
      updateStats();
      updateEmotionChart();
    }

    function updateStats() {
      if (isAdmin) {
        updateAdminStats();
      }
    }

    function updateAdminStats() {
      document.getElementById('totalWishes').textContent = wishHistory.length;
      
      const today = new Date().toDateString();
      const todayCount = wishHistory.filter(item => 
        new Date(item.timestamp).toDateString() === today
      ).length;
      document.getElementById('todayWishes').textContent = todayCount;
      
      const uniqueUsers = new Set(wishHistory.map(item => item.userAgent)).size;
      document.getElementById('totalUsers').textContent = uniqueUsers;
      
      let topEmotion = 'ì—†ìŒ';
      let maxCount = 0;
      const adminEmotionStats = {};
      
      wishHistory.forEach(item => {
        adminEmotionStats[item.emotion] = (adminEmotionStats[item.emotion] || 0) + 1;
      });
      
      for (const [emotion, count] of Object.entries(adminEmotionStats)) {
        if (count > maxCount) {
          maxCount = count;
          topEmotion = emotion;
        }
      }
      document.getElementById('topEmotion').textContent = topEmotion;
      
      updateAdminEmotionChart(adminEmotionStats);
    }

    function updateEmotionChart() {
      if (isAdmin) return;
      
      const emotions = ['ì™¸ë¡œì›€', 'ìš•ë§', 'íšŒí”¼', 'ìŠ¬í””', 'ì™¸ëª¨', 'ëŠ¥ë ¥'];
      const totalWishes = Object.values(emotionStats).reduce((sum, count) => sum + count, 0);
      
      emotions.forEach(emotion => {
        const count = emotionStats[emotion] || 0;
        const percentage = totalWishes > 0 ? (count / totalWishes) * 100 : 0;
        
        const fillElement = document.querySelector(`[data-emotion="${emotion}"]`);
        const countElement = fillElement.parentElement.nextElementSibling;
        
        fillElement.style.width = percentage + '%';
        countElement.textContent = count;
      });
    }

    function updateAdminEmotionChart(adminEmotionStats) {
      const emotions = ['ì™¸ë¡œì›€', 'ìš•ë§', 'íšŒí”¼', 'ìŠ¬í””', 'ì™¸ëª¨', 'ëŠ¥ë ¥'];
      const totalWishes = Object.values(adminEmotionStats).reduce((sum, count) => sum + count, 0);
      
      emotions.forEach(emotion => {
        const count = adminEmotionStats[emotion] || 0;
        const percentage = totalWishes > 0 ? (count / totalWishes) * 100 : 0;
        
        const fillElement = document.querySelector(`[data-emotion="${emotion}"]`);
        const countElement = fillElement.parentElement.nextElementSibling;
        
        fillElement.style.width = percentage + '%';
        countElement.textContent = count;
      });
    }

    function loadAdminConversations() {
      const conversationsList = document.getElementById('adminConversations');
      
      if (wishHistory.length === 0) {
        conversationsList.innerHTML = `
          <div style="text-align: center; opacity: 0.5; padding: 2rem;">
            ëŒ€í™” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤
          </div>
        `;
        return;
      }
      
      conversationsList.innerHTML = wishHistory.map(item => {
        const date = new Date(item.timestamp);
        const timeStr = date.toLocaleString('ko-KR');
        
        return `
          <div class="conversation-item" onclick="showConversationModal(${item.id})">
            <div><strong>ì†Œì›:</strong> ${item.wish}</div>
            <div class="conversation-preview"><strong>ì‘ë‹µ:</strong> ${item.response.substring(0, 50)}...</div>
            <div class="history-time">${timeStr} Â· ${item.emotion}</div>
          </div>
        `;
      }).join('');
    }

    function showConversationModal(id) {
      const conversation = wishHistory.find(item => item.id === id);
      if (!conversation) return;
      
      const modal = document.getElementById('conversationModal');
      const modalContent = document.getElementById('modalContent');
      
      const date = new Date(conversation.timestamp);
      const timeStr = date.toLocaleString('ko-KR');
      
      modalContent.innerHTML = `
        <div style="margin-bottom: 1rem;">
          <strong>ì‹œê°„:</strong> ${timeStr}<br>
          <strong>ê°ì •:</strong> ${conversation.emotion}<br>
          <strong>ì‚¬ìš©ì:</strong> ${conversation.userAgent.substring(0, 50)}...
        </div>
        <div style="background: rgba(233, 30, 99, 0.1); padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
          <strong>ğŸ’­ ì†Œì›:</strong><br>
          ${conversation.wish}
        </div>
        <div style="background: rgba(233, 30, 99, 0.05); padding: 1rem; border-radius: 10px;">
          <strong>ğŸ§ ì‘ë‹µ:</strong><br>
          ${conversation.response}
        </div>
      `;
      
      modal.style.display = 'block';
    }

    function closeModal() {
      document.getElementById('conversationModal').style.display = 'none';
    }

    function checkDailyStreak() {
      const today = new Date().toDateString();
      const lastDate = userStats.lastDate;
      
      if (lastDate && lastDate !== today) {
        const last = new Date(lastDate);
        const current = new Date(today);
        const diffTime = Math.abs(current - last);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays > 1) {
          userStats.streak = 0;
          userStats.today = 0;
          localStorage.setItem('userStats', JSON.stringify(userStats));
          updateStats();
        }
      }
    }

    function clearHistory() {
      if (confirm('ğŸ—‘ï¸ ëª¨ë“  ì†Œì› ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ì–´ìš”?\n(í†µê³„ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤)')) {
        wishHistory = [];
        emotionStats = {};
        userStats = { total: 0, today: 0, streak: 0, lastDate: null };
        
        localStorage.removeItem('wishHistory');
        localStorage.removeItem('emotionStats');
        localStorage.removeItem('userStats');
        
        loadHistory();
        updateStats();
        updateEmotionChart();
        
        if (isAdmin) {
          loadAdminConversations();
          updateAdminStats();
        }
        
        showToast('ğŸ—‘ï¸ ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œëì–´ìš”!');
        playSound('success');
      }
    }

    window.onclick = function(event) {
      const modal = document.getElementById('conversationModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }

    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.body.setAttribute('data-theme', savedTheme);
    }

    window.onload = function() {
      document.getElementById("wishInput").focus();
    };
  </script>
</body>
</html>